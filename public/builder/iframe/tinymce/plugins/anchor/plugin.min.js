!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),t=function(e){return function(t){for(var n=0;n<t.length;n++)(o=t[n]).attr("href")||!o.attr("id")&&!o.attr("name")||o.firstChild||t[n].attr("contenteditable",e);var o}};e.add("anchor",(function(e){var n;(function(e){e.on("PreInit",(function(){e.parser.addNodeFilter("a",t("false")),e.serializer.addNodeFilter("a",t(null))}))})(e),function(e){e.addCommand("mceAnchor",(function(){!function(e){var t=function(e){var t=e.selection.getNode();return"A"===t.tagName&&""===e.dom.getAttrib(t,"href")?t.getAttribute("id")||t.getAttribute("name"):""}(e);e.windowManager.open({title:"Anchor",size:"normal",body:{type:"panel",items:[{name:"id",type:"input",label:"ID",placeholder:"example"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{id:t},onSubmit:function(t){var n,o;n=e,(function(e){return/^[A-Za-z][A-Za-z0-9\-:._]*$/.test(e)}(o=t.getData().id)?(function(e,t){var n=e.selection.getNode();"A"===n.tagName&&""===e.dom.getAttrib(n,"href")?(n.removeAttribute("name"),n.id=t,e.undoManager.add()):(e.focus(),e.selection.collapse(!0),e.execCommand("mceInsertContent",!1,e.dom.createHTML("a",{id:t})))}(n,o),0):(n.windowManager.alert("Id should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores."),1))||t.close()}})}(e)}))}(e),(n=e).ui.registry.addToggleButton("anchor",{icon:"bookmark",tooltip:"Anchor",onAction:function(){return n.execCommand("mceAnchor")},onSetup:function(e){return n.selection.selectorChangedWithUnbind("a:not([href])",e.setActive).unbind}}),n.ui.registry.addMenuItem("anchor",{icon:"bookmark",text:"Anchor...",onAction:function(){return n.execCommand("mceAnchor")}})}))}();