!function(n){"use strict";var t,e,r,o,i,u=tinymce.util.Tools.resolve("tinymce.PluginManager"),c=function(n){return function(){return n}},a=c(!1),l=c(!0),s=a,f=l,m=function(){return g},g=(o={fold:function(n,t){return n()},is:s,isSome:s,isNone:f,getOr:r=function(n){return n},getOrThunk:e=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){},or:r,orThunk:e,map:m,ap:m,each:function(){},bind:m,flatten:m,exists:s,forall:f,filter:m,equals:t=function(n){return n.isNone()},equals_:t,toArray:function(){return[]},toString:c("none()")},Object.freeze&&Object.freeze(o),o),d=function(n){var t=function(){return n},e=function(){return o},r=function(t){return t(n)},o={fold:function(t,e){return e(n)},is:function(t){return n===t},isSome:f,isNone:s,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:e,orThunk:e,map:function(t){return d(t(n))},ap:function(t){return t.fold(m,(function(t){return d(t(n))}))},each:function(t){t(n)},bind:r,flatten:t,exists:r,forall:r,filter:function(t){return t(n)?o:g},equals:function(t){return t.is(n)},equals_:function(t,e){return t.fold(s,(function(t){return e(n,t)}))},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return o},y={some:d,none:m,from:function(n){return null==n?g:d(n)}},p=(Array.prototype.slice,function(n){return"function"===function(n){if(null===n)return"null";var t=typeof n;return"object"===t&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":t}(n)}(Array.from)&&Array.from,function(n,t){return-1!==n.indexOf(t)}),v=function(n,t){return p(n.title.toLowerCase(),t)||function(n,t){for(var e=0,r=n.length;e<r;e++)if(t(n[e]))return y.some(e);return y.none()}(n.keywords,(function(n){return p(n.toLowerCase(),t)})).isSome()},h=function(n,t,e){for(var r=[],o=t.toLowerCase(),i=e.fold((function(){return a}),(function(n){return function(t){return n<=t}})),u=0;u<n.length&&(0!==t.length&&!v(n[u],o)||(r.push({value:n[u].char,text:n[u].title,icon:n[u].char}),!i(r.length)));u++);return r},b=function(n){var t=n,e=function(){return t};return{get:e,set:function(n){t=n},clone:function(){return b(e())}}},w=Object.prototype.hasOwnProperty,O=(i=function(n,t){return t},function(){for(var n=new Array(arguments.length),t=0;t<n.length;t++)n[t]=arguments[t];if(0===n.length)throw new Error("Can't merge zero objects");for(var e={},r=0;r<n.length;r++){var o=n[r];for(var u in o)w.call(o,u)&&(e[u]=i(e[u],o[u]))}return e}),A=Object.keys,j=Object.hasOwnProperty,C=function(n,t){for(var e=A(n),r=0,o=e.length;r<o;r++){var i=e[r];t(n[i],i,n)}},k=tinymce.util.Tools.resolve("tinymce.Resource"),T=tinymce.util.Tools.resolve("tinymce.util.Delay"),_=tinymce.util.Tools.resolve("tinymce.util.Promise"),P="All",S={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},D=function(n,t){return e=n,r=t,j.call(e,r)?n[t]:t;var e,r},x="pattern";u.add("emoticons",(function(t,e){var r,o,i=function(n,t){return n.getParam("emoticons_database_url",t+"/js/emojis"+n.suffix+".js")}(t,e),u=function(n){return n.getParam("emoticons_database_id","tinymce.plugins.emoticons","string")}(t),c=function(t,e,r){var o=b(y.none()),i=b(y.none());t.on("init",(function(){k.load(r,e).then((function(n){var e,r,u,c=function(n){var t,e=function(n){return n.getParam("emoticons_append",{},"object")}(n);return t=function(n){return O({keywords:[],category:"user"},n)},function(n,t){var e={};return C(n,(function(n,r){var o=t(n,r);e[o.k]=o.v})),e}(e,(function(n,e,r){return{k:e,v:t(n)}}))}(t);e=O(n,c),r={},u=[],C(e,(function(n,t){var e={title:t,keywords:n.keywords,char:n.char,category:D(S,n.category)},o=void 0!==r[e.category]?r[e.category]:[];r[e.category]=o.concat([e]),u.push(e)})),o.set(y.some(r)),i.set(y.some(u))}),(function(t){n.console.log("Failed to load emoticons: "+t),o.set(y.some({})),i.set(y.some([]))}))}));var u=function(){return i.get().getOr([])},c=function(){return o.get().isSome()&&i.get().isSome()};return{listCategories:function(){return[P].concat(A(o.get().getOr({})))},hasLoaded:c,waitForLoad:function(){return c()?_.resolve(!0):new _((function(t,r){var o=3,i=T.setInterval((function(){c()?(T.clearInterval(i),t(!0)):--o<0&&(n.console.log("Could not load emojis from url: "+e),T.clearInterval(i),r(!1))}),500)}))},listAll:u,listCategory:function(n){return n===P?u():o.get().bind((function(t){return y.from(t[n])})).getOr([])}}}(t,i,u);(function(t,e){var r=function(){return function(t,e){var r,o,i={pattern:"",results:h(e.listAll(),"",y.some(300))},u=b(P),c=(r=function(n){var t,r,o,i,c;r=(t=n).getData(),o=u.get(),i=e.listCategory(o),c=h(i,r[x],o===P?y.some(300):y.none()),t.setData({results:c})},o=null,{cancel:function(){null!==o&&(n.clearTimeout(o),o=null)},throttle:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];null!==o&&n.clearTimeout(o),o=n.setTimeout((function(){r.apply(null,t),o=null}),200)}}),a={label:"Search",type:"input",name:x},l={type:"collection",name:"results"},s=function(){return{title:"Emoticons",size:"normal",body:{type:"tabpanel",tabs:function(n,t){for(var e=n.length,r=new Array(e),o=0;o<e;o++){var i=n[o];r[o]=t(i)}return r}(e.listCategories(),(function(n){return{title:n,name:n,items:[a,l]}}))},initialData:i,onTabChange:function(n,t){u.set(t.newTabName),c.throttle(n)},onChange:c.throttle,onAction:function(n,e){var r,o;"results"===e.name&&(r=t,o=e.value,r.insertContent(o),n.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}},f=t.windowManager.open(s());f.focus(x),e.hasLoaded()||(f.block("Loading emoticons..."),e.waitForLoad().then((function(){f.redial(s()),c.throttle(f),f.focus(x),f.unblock()})).catch((function(n){f.redial({title:"Emoticons",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"<p>Could not load emoticons</p>"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),f.focus(x),f.unblock()})))}(t,e)};t.ui.registry.addButton("emoticons",{tooltip:"Emoticons",icon:"emoji",onAction:r}),t.ui.registry.addMenuItem("emoticons",{text:"Emoticons...",icon:"emoji",onAction:r})})(t,c),o=c,(r=t).ui.registry.addAutocompleter("emoticons",{ch:":",columns:"auto",minChars:2,fetch:function(n,t){return o.waitForLoad().then((function(){var e=o.listAll();return h(e,n,y.some(t))}))},onAction:function(n,t,e){r.selection.setRng(t),r.insertContent(e),n.hide()}})}))}(window);