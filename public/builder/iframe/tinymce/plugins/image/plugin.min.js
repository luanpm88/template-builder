!function(t){"use strict";var e,n,r,i,o,a,u=tinymce.util.Tools.resolve("tinymce.PluginManager"),c=function(){},l=function(t){return function(){return t}},s=function(t){return t},f=l(!1),m=l(!0),d=f,p=m,g=function(){return h},h=(i={fold:function(t,e){return t()},is:d,isSome:d,isNone:p,getOr:r=function(t){return t},getOrThunk:n=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){},or:r,orThunk:n,map:g,ap:g,each:function(){},bind:g,flatten:g,exists:d,forall:p,filter:g,equals:e=function(t){return t.isNone()},equals_:e,toArray:function(){return[]},toString:l("none()")},Object.freeze&&Object.freeze(i),i),v=function(t){var e=function(){return t},n=function(){return i},r=function(e){return e(t)},i={fold:function(e,n){return n(t)},is:function(e){return t===e},isSome:p,isNone:d,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:n,orThunk:n,map:function(e){return v(e(t))},ap:function(e){return e.fold(g,(function(e){return v(e(t))}))},each:function(e){e(t)},bind:r,flatten:e,exists:r,forall:r,filter:function(e){return e(t)?i:h},equals:function(e){return e.is(t)},equals_:function(e,n){return e.fold(d,(function(e){return n(t,e)}))},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return i},y={some:v,none:g,from:function(t){return null==t?h:v(t)}},b=function(t){return function(e){return function(t){if(null===t)return"null";var e=typeof t;return"object"===e&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"===e&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":e}(e)===t}},w=b("string"),T=b("object"),_=b("array"),x=b("boolean"),A=b("function"),S=(Array.prototype.slice,Array.prototype.push),I=function(t){for(var e=[],n=0,r=t.length;n<r;++n){if(!_(t[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+t);S.apply(e,t[n])}return e},O=(A(Array.from)&&Array.from,function(){return(O=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)}),D={},P={exports:D};o=D,a=P,function(t){"object"==typeof o&&void 0!==a?a.exports=t():("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EphoxContactWrapper=t()}((function(){return function t(e,n,r){function i(a,u){if(!n[a]){if(!e[a]){if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};e[a][0].call(l.exports,(function(t){return i(e[a][1][t]||t)}),l,l.exports,t,e,n,r)}return n[a].exports}for(var o=!1,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(t,e,n){var r,i,o=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function u(){throw new Error("clearTimeout has not been defined")}function c(t){if(r===setTimeout)return setTimeout(t,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(t){r=a}try{i="function"==typeof clearTimeout?clearTimeout:u}catch(t){i=u}}();var l,s=[],f=!1,m=-1;function d(){f&&l&&(f=!1,l.length?s=l.concat(s):m=-1,s.length&&p())}function p(){if(!f){var t=c(d);f=!0;for(var e=s.length;e;){for(l=s,s=[];++m<e;)l&&l[m].run();m=-1,e=s.length}l=null,f=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===u||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{return i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function g(t,e){this.fun=t,this.array=e}function h(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new g(t,e)),1!==s.length||f||c(p)},g.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=h,o.addListener=h,o.once=h,o.off=h,o.removeListener=h,o.removeAllListeners=h,o.emit=h,o.prependListener=h,o.prependOnceListener=h,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],2:[function(t,e,n){(function(t){!function(n){var r=setTimeout;function i(){}function o(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(t,this)}function a(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,o._immediateFn((function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var r;try{r=n(t._value)}catch(t){return void c(e.promise,t)}u(e.promise,r)}else(1===t._state?u:c)(e.promise,t._value)}))):t._deferreds.push(e)}function u(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof o)return t._state=3,t._value=e,void l(t);if("function"==typeof n)return void f(function(t,e){return function(){t.apply(e,arguments)}}(n,e),t)}t._state=1,t._value=e,l(t)}catch(e){c(t,e)}}function c(t,e){t._state=2,t._value=e,l(t)}function l(t){2===t._state&&0===t._deferreds.length&&o._immediateFn((function(){t._handled||o._unhandledRejectionFn(t._value)}));for(var e=0,n=t._deferreds.length;e<n;e++)a(t,t._deferreds[e]);t._deferreds=null}function s(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function f(t,e){var n=!1;try{t((function(t){n||(n=!0,u(e,t))}),(function(t){n||(n=!0,c(e,t))}))}catch(t){if(n)return;n=!0,c(e,t)}}o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var n=new this.constructor(i);return a(this,new s(t,e,n)),n},o.all=function(t){var e=Array.prototype.slice.call(t);return new o((function(t,n){if(0===e.length)return t([]);var r=e.length;function i(o,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var u=a.then;if("function"==typeof u)return void u.call(a,(function(t){i(o,t)}),n)}e[o]=a,0==--r&&t(e)}catch(t){n(t)}}for(var o=0;o<e.length;o++)i(o,e[o])}))},o.resolve=function(t){return t&&"object"==typeof t&&t.constructor===o?t:new o((function(e){e(t)}))},o.reject=function(t){return new o((function(e,n){n(t)}))},o.race=function(t){return new o((function(e,n){for(var r=0,i=t.length;r<i;r++)t[r].then(e,n)}))},o._immediateFn="function"==typeof t?function(e){t(e)}:function(t){r(t,0)},o._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)},o._setImmediateFn=function(t){o._immediateFn=t},o._setUnhandledRejectionFn=function(t){o._unhandledRejectionFn=t},void 0!==e&&e.exports?e.exports=o:n.Promise||(n.Promise=o)}(this)}).call(this,t("timers").setImmediate)},{timers:3}],3:[function(t,e,n){(function(e,r){var i=t("process/browser.js").nextTick,o=Function.prototype.apply,a=Array.prototype.slice,u={},c=0;function l(t,e){this._id=t,this._clearFn=e}n.setTimeout=function(){return new l(o.call(setTimeout,window,arguments),clearTimeout)},n.setInterval=function(){return new l(o.call(setInterval,window,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(t){t.close()},l.prototype.unref=l.prototype.ref=function(){},l.prototype.close=function(){this._clearFn.call(window,this._id)},n.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},n.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},n._unrefActive=n.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;0<=e&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},n.setImmediate="function"==typeof e?e:function(t){var e=c++,r=!(arguments.length<2)&&a.call(arguments,1);return u[e]=!0,i((function(){u[e]&&(r?t.apply(null,r):t.call(null),n.clearImmediate(e))})),e},n.clearImmediate="function"==typeof r?r:function(t){delete u[t]}}).call(this,t("timers").setImmediate,t("timers").clearImmediate)},{"process/browser.js":1,timers:3}],4:[function(t,e,n){var r=t("promise-polyfill"),i="undefined"!=typeof window?window:Function("return this;")();e.exports={boltExport:i.Promise||r}},{"promise-polyfill":2}]},{},[4])(4)}));var C=P.exports.boltExport,E=function(e){var n=y.none(),r=[],i=function(t){o()?a(t):r.push(t)},o=function(){return n.isSome()},a=function(e){n.each((function(n){t.setTimeout((function(){e(n)}),0)}))};return e((function(t){n=y.some(t),function(t){!function(t,e){for(var n=0,r=t.length;n<r;n++)e(t[n],n,t)}(t,a)}(r),r=[]})),{get:i,map:function(t){return E((function(e){i((function(n){e(t(n))}))}))},isReady:o}},U={nu:E,pure:function(t){return E((function(e){e(t)}))}},N=function(e){t.setTimeout((function(){throw e}),0)},j=function(t){var e=function(e){t().then(e,N)};return{map:function(e){return j((function(){return t().then(e)}))},bind:function(e){return j((function(){return t().then((function(t){return e(t).toPromise()}))}))},anonBind:function(e){return j((function(){return t().then((function(){return e.toPromise()}))}))},toLazy:function(){return U.nu(e)},toCached:function(){var e=null;return j((function(){return null===e&&(e=t()),e}))},toPromise:t,get:e}},L=function(t){return j((function(){return new C(t)}))},R=function(t){return{is:function(e){return t===e},isValue:m,isError:f,getOr:l(t),getOrThunk:l(t),getOrDie:l(t),or:function(e){return R(t)},orThunk:function(e){return R(t)},fold:function(e,n){return n(t)},map:function(e){return R(e(t))},mapError:function(e){return R(t)},each:function(e){e(t)},bind:function(e){return e(t)},exists:function(e){return e(t)},forall:function(e){return e(t)},toOption:function(){return y.some(t)}}},F=function(t){return{is:f,isValue:f,isError:m,getOr:s,getOrThunk:function(t){return t()},getOrDie:function(){return e=String(t),function(){throw new Error(e)}();var e},or:function(t){return t},orThunk:function(t){return t()},fold:function(e,n){return e(t)},map:function(e){return F(t)},mapError:function(e){return F(e(t))},each:c,bind:function(e){return F(t)},exists:f,forall:m,toOption:y.none}},k={value:R,error:F,fromOption:function(t,e){return t.fold((function(){return F(e)}),R)}},z=function(e){return O({},e,{toCached:function(){return z(e.toCached())},bindFuture:function(t){return z(e.bind((function(e){return e.fold((function(t){return function(t){return j((function(){return C.resolve(t)}))}(k.error(t))}),(function(e){return t(e)}))})))},bindResult:function(t){return z(e.map((function(e){return e.bind(t)})))},mapResult:function(t){return z(e.map((function(e){return e.map(t)})))},mapError:function(t){return z(e.map((function(e){return e.mapError(t)})))},foldResult:function(t,n){return e.map((function(e){return e.fold(t,n)}))},withTimeout:function(n,r){return z(L((function(i){var o=!1,a=t.setTimeout((function(){o=!0,i(k.error(r()))}),n);e.get((function(e){o||(t.clearTimeout(a),i(e))}))})))}})},M=Object.prototype.hasOwnProperty,B=function(t){return function(){for(var e=new Array(arguments.length),n=0;n<e.length;n++)e[n]=arguments[n];if(0===e.length)throw new Error("Can't merge zero objects");for(var r={},i=0;i<e.length;i++){var o=e[i];for(var a in o)M.call(o,a)&&(r[a]=t(r[a],o[a]))}return r}},H=B((function(t,e){return T(t)&&T(e)?H(t,e):e})),G=B((function(t,e){return e})),W=function(t){var e=t.imageList.map((function(t){return{name:"images",type:"selectbox",label:"Image list",items:t}})),n=t.classList.map((function(t){return{name:"classes",type:"selectbox",label:"Class",items:t}}));return I([[{name:"src",type:"urlinput",filetype:"image",label:"Source"}],e.toArray(),t.hasDescription?[{name:"alt",type:"input",label:"Image description"}]:[],t.hasImageTitle?[{name:"title",type:"input",label:"Image title"}]:[],t.hasDimensions?[{name:"dimensions",type:"sizeinput"}]:[],[{type:"grid",columns:2,items:I([n.toArray(),t.hasImageCaption?[{type:"label",label:"Caption",items:[{type:"checkbox",name:"caption",label:"Show caption"}]}]:[]])}]])},q=function(t){return{title:"General",name:"general",items:W(t)}},$=W,J=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),V=tinymce.util.Tools.resolve("tinymce.util.Promise"),X=tinymce.util.Tools.resolve("tinymce.util.XHR"),Z=function(t){return t.getParam("images_upload_url","","string")},K=function(t){return t.getParam("images_upload_handler",void 0,"function")},Q=function(t){return t.getParam("image_dimensions",!0,"boolean")},Y=Z,tt=K,et=function(t,e){return Math.max(parseInt(t,10),parseInt(e,10))},nt=function(t){return t&&(t=t.replace(/px$/,"")),t},rt=function(t){return 0<t.length&&/^[0-9]+$/.test(t)&&(t+="px"),t},it=function(t){if(t.margin){var e=String(t.margin).split(" ");switch(e.length){case 1:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[0],t["margin-bottom"]=t["margin-bottom"]||e[0],t["margin-left"]=t["margin-left"]||e[0];break;case 2:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[1],t["margin-bottom"]=t["margin-bottom"]||e[0],t["margin-left"]=t["margin-left"]||e[1];break;case 3:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[1],t["margin-bottom"]=t["margin-bottom"]||e[2],t["margin-left"]=t["margin-left"]||e[1];break;case 4:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[1],t["margin-bottom"]=t["margin-bottom"]||e[2],t["margin-left"]=t["margin-left"]||e[3]}delete t.margin}return t},ot=function(t){return"IMG"===t.nodeName&&(t.hasAttribute("data-mce-object")||t.hasAttribute("data-mce-placeholder"))},at=J.DOM,ut=function(t){return t.style.marginLeft&&t.style.marginRight&&t.style.marginLeft===t.style.marginRight?nt(t.style.marginLeft):""},ct=function(t){return t.style.marginTop&&t.style.marginBottom&&t.style.marginTop===t.style.marginBottom?nt(t.style.marginTop):""},lt=function(t){return t.style.borderWidth?nt(t.style.borderWidth):""},st=function(t,e){return t.hasAttribute(e)?t.getAttribute(e):""},ft=function(t,e){return t.style[e]?t.style[e]:""},mt=function(t){return null!==t.parentNode&&"FIGURE"===t.parentNode.nodeName},dt=function(t,e,n){t.setAttribute(e,n)},pt=function(t,e){var n=t.getAttribute("style"),r=e(null!==n?n:"");0<r.length?(t.setAttribute("style",r),t.setAttribute("data-mce-style",r)):t.removeAttribute("style")},gt=function(t,e){return function(t,n,r){t.style[n]?(t.style[n]=rt(r),pt(t,e)):dt(t,n,r)}},ht=function(t,e){return t.style[e]?nt(t.style[e]):st(t,e)},vt=function(t,e){var n=rt(e);t.style.marginLeft=n,t.style.marginRight=n},yt=function(t,e){var n=rt(e);t.style.marginTop=n,t.style.marginBottom=n},bt=function(t,e){var n=rt(e);t.style.borderWidth=n},wt=function(t,e){t.style.borderStyle=e},Tt=function(t){return"FIGURE"===t.nodeName},_t=function(e,n){var r=t.document.createElement("img");return dt(r,"style",n.style),(ut(r)||""!==n.hspace)&&vt(r,n.hspace),(ct(r)||""!==n.vspace)&&yt(r,n.vspace),(lt(r)||""!==n.border)&&bt(r,n.border),(ft(r,"borderStyle")||""!==n.borderStyle)&&wt(r,n.borderStyle),e(r.getAttribute("style"))},xt=function(t,e){return{src:st(e,"src"),alt:st(e,"alt"),title:st(e,"title"),width:ht(e,"width"),height:ht(e,"height"),class:st(e,"class"),style:t(st(e,"style")),caption:mt(e),hspace:ut(e),vspace:ct(e),border:lt(e),borderStyle:ft(e,"borderStyle")}},At=function(t,e,n,r,i){n[r]!==e[r]&&i(t,r,n[r])},St=function(t,e){return function(n,r,i){t(n,i),pt(n,e)}},It=function(t,e,n){var r=xt(t,n);At(n,r,e,"caption",(function(t,e,n){return function(t){var e,n,r,i;mt(t)?(i=(r=t).parentNode,at.insertAfter(r,i),at.remove(i)):(e=t,n=at.create("figure",{class:"image"}),at.insertAfter(n,e),n.appendChild(e),n.appendChild(at.create("figcaption",{contentEditable:"true"},"Caption")),n.contentEditable="false")}(t)})),At(n,r,e,"src",dt),At(n,r,e,"alt",dt),At(n,r,e,"title",dt),At(n,r,e,"width",gt(0,t)),At(n,r,e,"height",gt(0,t)),At(n,r,e,"class",dt),At(n,r,e,"style",St((function(t,e){return dt(t,"style",e)}),t)),At(n,r,e,"hspace",St(vt,t)),At(n,r,e,"vspace",St(yt,t)),At(n,r,e,"border",St(bt,t)),At(n,r,e,"borderStyle",St(wt,t))},Ot=function(t,e){var n=t.dom.styles.parse(e),r=it(n),i=t.dom.styles.parse(t.dom.styles.serialize(r));return t.dom.styles.serialize(i)},Dt=function(t){var e=t.selection.getNode(),n=t.dom.getParent(e,"figure.image");return n?t.dom.select("img",n)[0]:e&&("IMG"!==e.nodeName||ot(e))?null:e},Pt=function(t,e){var n=t.dom,r=n.getParent(e.parentNode,(function(e){return t.schema.getTextBlockElements()[e.nodeName]}),t.getBody());return r?n.split(r,e):e},Ct=tinymce.util.Tools.resolve("tinymce.util.Tools"),Et=function(t){return w(t.value)?t.value:""},Ut=function(t,e){var n=[];return Ct.each(t,(function(t){var r=w(t.text)?t.text:w(t.title)?t.title:"";if(void 0!==t.menu){var i=Ut(t.menu,e);n.push({text:r,items:i})}else{var o=e(t);n.push({text:r,value:o})}})),n},Nt=function(t){return void 0===t&&(t=Et),function(e){return e?y.from(e).map((function(e){return Ut(e,t)})):y.none()}},jt=function(t,e){return function(t,e){for(var n=0;n<t.length;n++){var r=e(t[n]);if(r.isSome())return r}return y.none()}(t,(function(t){return n=t,Object.prototype.hasOwnProperty.call(n,"items")?jt(t.items,e):t.value===e?y.some(t):y.none();var n}))},Lt=Nt,Rt=function(t,e){return t.bind((function(t){return jt(t,e)}))};function Ft(e){var n=function(n,r,i,o){var a,u;(a=new t.XMLHttpRequest).open("POST",e.url),a.withCredentials=e.credentials,a.upload.onprogress=function(t){o(t.loaded/t.total*100)},a.onerror=function(){i("Image upload failed due to a XHR Transport error. Code: "+a.status)},a.onload=function(){var t,n,o;a.status<200||300<=a.status?i("HTTP Error: "+a.status):(t=JSON.parse(a.responseText))&&"string"==typeof t.location?r((n=e.basePath,o=t.location,n?n.replace(/\/$/,"")+"/"+o.replace(/^\//,""):o)):i("Invalid JSON: "+a.responseText)},(u=new t.FormData).append("file",n.blob(),n.filename()),a.send(u)};return e=Ct.extend({credentials:!1,handler:n},e),{upload:function(t){return e.url||e.handler!==n?(r=t,i=e.handler,new V((function(t,e){try{i(r,t,e,c)}catch(t){e(t.message)}}))):V.reject("Upload url missing from the settings.");var r,i}}}var kt=function(t){var e,n,r=Lt((function(e){return t.convertURL(e.value||e.url,"src")})),i=L((function(e){!function(t,e){var n=function(t){return t.getParam("image_list",!1)}(t);"string"==typeof n?X.send({url:n,success:function(t){e(JSON.parse(t))}}):"function"==typeof n?n(e):e(n)}(t,(function(t){e(r(t).map((function(t){return I([[{text:"None",value:""}],t])})))}))})),o=function(t){return Nt(Et)(t)}(function(t){return t.getParam("image_class_list")}(t)),a=function(t){return t.getParam("image_advtab",!1,"boolean")}(t),u=function(t){return t.getParam("image_uploadtab",!0,"boolean")}(t),c=function(t){return!!Z(t)}(t),l=function(t){return!!K(t)}(t),s=(n=Dt(e=t))?xt((function(t){return Ot(e,t)}),n):{src:"",alt:"",title:"",width:"",height:"",class:"",style:"",caption:!1,hspace:"",vspace:"",border:"",borderStyle:""},f=function(t){return t.getParam("image_description",!0,"boolean")}(t),m=function(t){return t.getParam("image_title",!1,"boolean")}(t),d=Q(t),p=function(t){return t.getParam("image_caption",!1,"boolean")}(t),g=Y(t),h=function(t){return t.getParam("images_upload_base_path",void 0,"string")}(t),v=function(t){return t.getParam("images_upload_credentials",!1,"boolean")}(t),b=tt(t),T=y.some(function(t){return t.getParam("image_prepend_url","","string")}(t)).filter((function(t){return w(t)&&0<t.length}));return i.map((function(t){return{image:s,imageList:t,classList:o,hasAdvTab:a,hasUploadTab:u,hasUploadUrl:c,hasUploadHandler:l,hasDescription:f,hasImageTitle:m,hasDimensions:d,hasImageCaption:p,url:g,basePath:h,credentials:v,handler:b,prependURL:T}}))},zt=function(t){return{src:{value:t.src,meta:{}},images:t.src,alt:t.alt,title:t.title,dimensions:{width:t.width,height:t.height},classes:t.class,caption:t.caption,style:t.style,vspace:t.vspace,border:t.border,hspace:t.hspace,borderstyle:t.borderStyle,fileinput:[]}},Mt=function(t){return{src:t.src.value,alt:t.alt,title:t.title,width:t.dimensions.width,height:t.dimensions.height,class:t.classes,style:t.style,caption:t.caption,hspace:t.hspace,vspace:t.vspace,border:t.border,borderStyle:t.borderstyle}},Bt=function(t,e,n,r){var i,o,a,u,c,l,s,f,m,d,p,g;(function(t,e){var n,r,i=e.getData();(n=t,r=i.src.value,/^(?:[a-zA-Z]+:)?\/\//.test(r)?y.none():n.prependURL.bind((function(t){return r.substring(0,t.length)!==t?y.some(t+r):y.none()}))).each((function(t){e.setData({src:{value:t,meta:i.src.meta}})}))})(e,r),function(t,e){var n,r,i,o=e.getData(),a=o.src.meta;if(void 0!==a){var u=H({},o);r=u,i=a,(n=t).hasDescription&&w(i.alt)&&(r.alt=i.alt),n.hasImageTitle&&w(i.title)&&(r.title=i.title),n.hasDimensions&&(w(i.width)&&(r.dimensions.width=i.width),w(i.height)&&(r.dimensions.height=i.height)),w(i.class)&&Rt(n.classList,i.class).each((function(t){r.classes=t.value})),n.hasImageCaption&&x(i.caption)&&(r.caption=i.caption),n.hasAdvTab&&(w(i.vspace)&&(r.vspace=i.vspace),w(i.border)&&(r.border=i.border),w(i.hspace)&&(r.hspace=i.hspace),w(i.borderstyle)&&(r.borderstyle=i.borderstyle)),e.setData(u)}}(e,r),i=t,o=e,a=n,l=(c=(u=r).getData()).src.value,(s=c.src.meta||{}).width||s.height||!o.hasDimensions||i.imageSize(l).get((function(t){t.each((function(t){a.open&&u.setData({dimensions:t})}))})),f=e,m=n,p=(d=r).getData(),g=Rt(f.imageList,p.src.value),m.prevImage=g,d.setData({images:g.map((function(t){return t.value})).getOr("")})},Ht=function(e,n,r,i){var o,a=i.getData();i.block("Uploading image"),(o=a.fileinput,0===o.length?y.none():y.some(o[0])).fold((function(){i.unblock()}),(function(o){var a=t.URL.createObjectURL(o),u=Ft({url:n.url,basePath:n.basePath,credentials:n.credentials,handler:n.handler}),c=function(){i.unblock(),t.URL.revokeObjectURL(a)};(function(e){return new V((function(n,r){var i=new t.FileReader;i.onload=function(){n(i.result)},i.onerror=function(){r(i.error.message)},i.readAsDataURL(e)}))})(o).then((function(t){var l=e.createBlobCache(o,a,t);u.upload(l).then((function(t){i.setData({src:{value:t,meta:{}}}),i.showTab("general"),Bt(e,n,r,i),c()})).catch((function(t){c(),e.alertErr(i,t)}))}))}))},Gt=function(t,e,n){return function(r,i){var o,a,u,c,l,s,f,m,d,p,g,h,v,y;"src"===i.name?Bt(t,e,n,r):"images"===i.name?(d=t,p=e,g=n,v=(h=r).getData(),(y=Rt(p.imageList,v.images)).each((function(t){""===v.alt||g.prevImage.map((function(t){return t.text===v.alt})).getOr(!1)?""===t.value?h.setData({src:t,alt:g.prevAlt}):h.setData({src:t,alt:t.text}):h.setData({src:t})})),g.prevImage=y,Bt(d,p,g,h)):"alt"===i.name?n.prevAlt=r.getData().alt:"style"===i.name?(l=t,f=(s=r).getData(),m=function(t,e,n){var r,i,o,a,u,c=it(t(n.style)),l=H({},n);return l.vspace=(r=c)["margin-top"]&&r["margin-bottom"]&&r["margin-top"]===r["margin-bottom"]?nt(String(r["margin-top"])):"",l.hspace=(i=c)["margin-right"]&&i["margin-left"]&&i["margin-right"]===i["margin-left"]?nt(String(i["margin-right"])):"",l.border=(o=c)["border-width"]?nt(String(o["border-width"])):"",l.borderstyle=(a=c)["border-style"]?String(a["border-style"]):"",l.style=(u=e)(t(u(c))),l}(l.parseStyle,l.serializeStyle,f),s.setData(m)):"vspace"===i.name||"hspace"===i.name||"border"===i.name||"borderstyle"===i.name?(o=t,a=r,u=H(zt(e.image),a.getData()),c=_t(o.normalizeCss,Mt(u)),a.setData({style:c})):"fileinput"===i.name&&Ht(t,e,n,r)}},Wt=function(e){var n,r,i,o,a,u,c,l={onSubmit:(c=e,function(e){return function(n){var r=H(zt(e.image),n.getData());c.undoManager.transact((function(){!function(e,n){var r=Dt(e);r?n.src?function(t,e){var n,r=Dt(t);if(It((function(e){return Ot(t,e)}),e,r),n=r,t.dom.setAttrib(n,"src",n.getAttribute("src")),Tt(r.parentNode)){var i=r.parentNode;Pt(t,i),t.selection.select(r.parentNode)}else t.selection.select(r),function(t,e,n){var r=function(){n.onload=n.onerror=null,t.selection&&(t.selection.select(n),t.nodeChanged())};n.onload=function(){e.width||e.height||!Q(t)||t.dom.setAttribs(n,{width:String(n.clientWidth),height:String(n.clientHeight)}),r()},n.onerror=r}(t,e,r)}(e,n):function(t,e){if(e){var n=t.dom.is(e.parentNode,"figure.image")?e.parentNode:e;t.dom.remove(n),t.focus(),t.nodeChanged(),t.dom.isEmpty(t.getBody())&&(t.setContent(""),t.selection.setCursorLocation())}}(e,r):n.src&&function(e,n){var r=function(e,n){var r=t.document.createElement("img");if(It(e,G(n,{caption:!1}),r),dt(r,"alt",n.alt),n.caption){var i=at.create("figure",{class:"image"});return i.appendChild(r),i.appendChild(at.create("figcaption",{contentEditable:"true"},"Caption")),i.contentEditable="false",i}return r}((function(t){return Ot(e,t)}),n);e.dom.setAttrib(r,"data-mce-id","__mcenew"),e.focus(),e.selection.setContent(r.outerHTML);var i=e.dom.select('*[data-mce-id="__mcenew"]')[0];if(e.dom.setAttrib(i,"data-mce-id",null),Tt(i)){var o=Pt(e,i);e.selection.select(o)}else e.selection.select(i)}(e,n)}(c,Mt(r))})),c.editorUpload.uploadImagesAuto(),n.close()}}),imageSize:(u=e,function(e){return function(t){return z(L(t))}((function(n){!function(e,n){var r=t.document.createElement("img"),i=function(t){r.parentNode&&r.parentNode.removeChild(r),n(t)};r.onload=function(){var t={width:et(r.width,r.clientWidth),height:et(r.height,r.clientHeight)};i(k.value(t))},r.onerror=function(){i(k.error("Failed to get image dimensions for: "+e))};var o=r.style;o.visibility="hidden",o.position="fixed",o.bottom=o.left="0px",o.width=o.height="auto",t.document.body.appendChild(r),r.src=e}(u.documentBaseURI.toAbsolute(e),(function(t){var e=t.map((function(t){return{width:String(t.width),height:String(t.height)}}));n(e)}))}))}),createBlobCache:(a=e,function(t,e,n){return a.editorUpload.blobCache.create({blob:t,blobUri:e,name:t.name?t.name.replace(/\.[^\.]+$/,""):null,base64:n.split(",")[1]})}),alertErr:(o=e,function(t,e){o.windowManager.alert(e,t.close)}),normalizeCss:(i=e,function(t){return Ot(i,t)}),parseStyle:(r=e,function(t){return r.dom.parseStyle(t)}),serializeStyle:(n=e,function(t,e){return n.dom.serializeStyle(t,e)})};return{open:function(){return kt(e).map(function(t){return function(e){var n,r,i,o={prevImage:Rt((n=e).imageList,n.image.src),prevAlt:n.image.alt,open:!0};return{title:"Insert/Edit Image",size:"normal",body:(i=e,i.hasAdvTab||i.hasUploadUrl||i.hasUploadHandler?{type:"tabpanel",tabs:I([[q(i)],i.hasAdvTab?[{title:"Advanced",name:"advanced",items:[{type:"input",label:"Style",name:"style"},{type:"grid",columns:2,items:[{type:"input",label:"Vertical space",name:"vspace"},{type:"input",label:"Horizontal space",name:"hspace"},{type:"input",label:"Border width",name:"border"},{type:"selectbox",name:"borderstyle",label:"Border style",items:[{text:"Select...",value:""},{text:"Solid",value:"solid"},{text:"Dotted",value:"dotted"},{text:"Dashed",value:"dashed"},{text:"Double",value:"double"},{text:"Groove",value:"groove"},{text:"Ridge",value:"ridge"},{text:"Inset",value:"inset"},{text:"Outset",value:"outset"},{text:"None",value:"none"},{text:"Hidden",value:"hidden"}]}]}]}]:[],i.hasUploadTab&&(i.hasUploadUrl||i.hasUploadHandler)?[{title:"Upload",name:"upload",items:[{type:"dropzone",name:"fileinput"}]}]:[]])}:{type:"panel",items:$(i)}),buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:zt(e.image),onSubmit:t.onSubmit(e),onChange:Gt(t,e,o),onClose:(r=o,function(){r.open=!1})}}}(l)).get((function(t){e.windowManager.open(t)}))}}},qt=function(t){return function(e){for(var n,r=e.length,i=function(e){e.attr("contenteditable",t?"true":null)};r--;){var o=e[r];(n=o.attr("class"))&&/\bimage\b/.test(n)&&(o.attr("contenteditable",t?"false":null),Ct.each(o.getAll("figcaption"),i))}}};u.add("image",(function(t){(function(t){t.on("PreInit",(function(){t.parser.addNodeFilter("figure",qt(!0)),t.serializer.addNodeFilter("figure",qt(!1))}))})(t),function(t){t.ui.registry.addToggleButton("image",{icon:"image",tooltip:"Insert/edit image",onAction:Wt(t).open,onSetup:function(e){return t.selection.selectorChangedWithUnbind("img:not([data-mce-object],[data-mce-placeholder]),figure.image",e.setActive).unbind}}),t.ui.registry.addMenuItem("image",{icon:"image",text:"Image...",onAction:Wt(t).open}),t.ui.registry.addContextMenu("image",{update:function(t){return Tt(t)||"IMG"===t.nodeName&&!ot(t)?["image"]:[]}})}(t),function(t){t.addCommand("mceImage",Wt(t).open)}(t)}))}(window);