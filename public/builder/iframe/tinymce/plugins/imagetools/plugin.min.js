!function(e){"use strict";var n,t,r,o,i=function(e){var n=e,t=function(){return n};return{get:t,set:function(e){n=e},clone:function(){return i(t())}}},u=tinymce.util.Tools.resolve("tinymce.PluginManager"),a=tinymce.util.Tools.resolve("tinymce.util.Tools"),c=function(e){return function(){return e}},s=c(!1),f=c(!0),l=s,d=f,m=function(){return h},h=(o={fold:function(e,n){return e()},is:l,isSome:l,isNone:d,getOr:r=function(e){return e},getOrThunk:t=function(e){return e()},getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){},or:r,orThunk:t,map:m,ap:m,each:function(){},bind:m,flatten:m,exists:l,forall:d,filter:m,equals:n=function(e){return e.isNone()},equals_:n,toArray:function(){return[]},toString:c("none()")},Object.freeze&&Object.freeze(o),o),g=function(e){var n=function(){return e},t=function(){return o},r=function(n){return n(e)},o={fold:function(n,t){return t(e)},is:function(n){return e===n},isSome:d,isNone:l,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:t,orThunk:t,map:function(n){return g(n(e))},ap:function(n){return n.fold(m,(function(n){return g(n(e))}))},each:function(n){n(e)},bind:r,flatten:n,exists:r,forall:r,filter:function(n){return n(e)?o:h},equals:function(n){return n.is(e)},equals_:function(n,t){return n.fold(l,(function(n){return t(e,n)}))},toArray:function(){return[e]},toString:function(){return"some("+e+")"}};return o},v={some:g,none:m,from:function(e){return null==e?h:g(e)}};function p(n,t){return b(e.document.createElement("canvas"),n,t)}function y(e){var n=p(e.width,e.height);return w(n).drawImage(e,0,0),n}function w(e){return e.getContext("2d")}function b(e,n,t){return e.width=n,e.height=t,e}var O=window.Promise?window.Promise:function(){var n=function(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],f(e,r(u,this),r(a,this))},t=n.immediateFn||"function"==typeof window.setImmediate&&window.setImmediate||function(n){e.setTimeout(n,1)};function r(e,n){return function(){return e.apply(n,arguments)}}var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function i(e){var n=this;null!==this._state?t((function(){var t=n._state?e.onFulfilled:e.onRejected;if(null!==t){var r;try{r=t(n._value)}catch(n){return void e.reject(n)}e.resolve(r)}else(n._state?e.resolve:e.reject)(n._value)})):this._deferreds.push(e)}function u(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void f(r(n,e),r(u,this),r(a,this))}this._state=!0,this._value=e,c.call(this)}catch(e){a.call(this,e)}}function a(e){this._state=!1,this._value=e,c.call(this)}function c(){for(var e=0,n=this._deferreds;e<n.length;e++){var t=n[e];i.call(this,t)}this._deferreds=[]}function s(e,n,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.resolve=t,this.reject=r}function f(e,n,t){var r=!1;try{e((function(e){r||(r=!0,n(e))}),(function(e){r||(r=!0,t(e))}))}catch(e){if(r)return;r=!0,t(e)}}return n.prototype.catch=function(e){return this.then(null,e)},n.prototype.then=function(e,t){var r=this;return new n((function(n,o){i.call(r,new s(e,t,n,o))}))},n.all=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Array.prototype.slice.call(1===e.length&&o(e[0])?e[0]:e);return new n((function(e,n){if(0===r.length)return e([]);var t=r.length;function o(i,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var a=u.then;if("function"==typeof a)return void a.call(u,(function(e){o(i,e)}),n)}r[i]=u,0==--t&&e(r)}catch(e){n(e)}}for(var i=0;i<r.length;i++)o(i,r[i])}))},n.resolve=function(e){return e&&"object"==typeof e&&e.constructor===n?e:new n((function(n){n(e)}))},n.reject=function(e){return new n((function(n,t){t(e)}))},n.race=function(e){return new n((function(n,t){for(var r=0,o=e;r<o.length;r++)o[r].then(n,t)}))},n}();function E(n){return new O((function(t,r){var o=e.URL.createObjectURL(n),i=new e.Image,u=function(){i.removeEventListener("load",a),i.removeEventListener("error",c)};function a(){u(),t(i)}function c(){u(),r("Unable to load data of type "+n.type+": "+o)}i.addEventListener("load",a),i.addEventListener("error",c),i.src=o,i.complete&&a()}))}function _(n){return new O((function(t,r){(function(n){var t=n.split(","),r=/data:([^;]+)/.exec(t[0]);if(!r)return v.none();for(var o=r[1],i=t[1],u=e.atob(i),a=u.length,c=Math.ceil(a/1024),s=new Array(c),f=0;f<c;++f){for(var l=1024*f,d=Math.min(l+1024,a),m=new Array(d-l),h=l,g=0;h<d;++g,++h)m[g]=u[h].charCodeAt(0);s[f]=new Uint8Array(m)}return v.some(new e.Blob(s,{type:o}))})(n).fold((function(){r("uri is not base64: "+n)}),t)}))}function T(n,t,r){return t=t||"image/png",e.HTMLCanvasElement.prototype.toBlob?new O((function(e,o){n.toBlob((function(n){n?e(n):o()}),t,r)})):_(n.toDataURL(t,r))}function I(e,n,t){var r=n.type;function o(n,t){return e.then((function(e){return function(e,n,t){return n=n||"image/png",e.toDataURL(n,t)}(e,n,t)}))}return{getType:c(r),toBlob:function(){return O.resolve(n)},toDataURL:function(){return t},toBase64:function(){return t.split(",")[1]},toAdjustedBlob:function(n,t){return e.then((function(e){return T(e,n,t)}))},toAdjustedDataURL:o,toAdjustedBase64:function(e,n){return o(e,n).then((function(e){return e.split(",")[1]}))},toCanvas:function(){return e.then(y)}}}function R(e,n){return T(e,n).then((function(n){return I(O.resolve(e),n,e.toDataURL())}))}var x,N,S,A=function(n){return function(n){return function(n){return new O((function(t){var r=new e.FileReader;r.onloadend=function(){t(r.result)},r.readAsDataURL(n)}))}(n).then((function(t){return I(function(n){return E(n).then((function(n){!function(n){e.URL.revokeObjectURL(n.src)}(n);var t=p(function(e){return e.naturalWidth||e.width}(n),function(e){return e.naturalHeight||e.height}(n));return w(t).drawImage(n,0,0),t}))}(n),n,t)}))}(n)},C=tinymce.util.Tools.resolve("tinymce.util.Delay"),U=tinymce.util.Tools.resolve("tinymce.util.Promise"),j=tinymce.util.Tools.resolve("tinymce.util.URI"),D=function(e){var n,t;function r(e){return/^[0-9\.]+px$/.test(e)}return n=e.style.width,t=e.style.height,n||t?r(n)&&r(t)?{w:parseInt(n,10),h:parseInt(t,10)}:null:(n=e.width,t=e.height,n&&t?{w:parseInt(n,10),h:parseInt(t,10)}:null)},L=function(e){return{w:e.naturalWidth,h:e.naturalHeight}},P=(Array.prototype.slice,function(e,n){for(var t=0,r=e.length;t<r;t++){var o=e[t];if(n(o,t,e))return v.some(o)}return v.none()}),k=(function(e){return"function"===function(e){if(null===e)return"null";var n=typeof e;return"object"===n&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"===n&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":n}(e)}(Array.from)&&Array.from,function(e){return null!=e}),M=function(n,t,r){return new U((function(o){var i;(i=new e.XMLHttpRequest).onreadystatechange=function(){4===i.readyState&&o({status:i.status,blob:this.response})},i.open("GET",n,!0),i.withCredentials=r,a.each(t,(function(e,n){i.setRequestHeader(n,e)})),i.responseType="blob",i.send()}))},B=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],F=[{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}],q=function(e){var n=function(e){return"ImageProxy HTTP error: "+P(B,(function(n){return e===n.code})).fold(c("Unknown ImageProxy error"),(function(e){return e.message}))}(e);return U.reject(n)},z=q,H=function(n,t){var r,o,i,u={"Content-Type":"application/json;charset=UTF-8","tiny-api-key":t};return M((r=n,o=t,i=-1===r.indexOf("?")?"?":"&",/[?&]apiKey=/.test(r)||!o?r:r+i+"apiKey="+encodeURIComponent(o)),u,!1).then((function(n){return n.status<200||300<=n.status?function(n,t){return 400===(r=n)||403===r||500===r?function(n,t){return function(n){return new U((function(t){var r=new e.FileReader;r.onload=function(e){var n=e.target;t(n.result)},r.readAsText(n)}))}(t).then((function(e){var n,t,r=(n=function(e){var n;try{n=JSON.parse(e)}catch(e){}return n}(e),"ImageProxy Service error: "+((t=function(e){var n;return n=["error","type"].reduce((function(e,n){return k(e)?e[n]:void 0}),e),k(n)?n:null}(n))?function(e){return P(F,(function(n){return n.type===e})).fold(c("Unknown service error"),(function(e){return e.message}))}(t):"Invalid JSON in service error message"));return U.reject(r)}))}(0,t):q(n);var r}(n.status,n.blob):U.resolve(n.blob)}))},$=function(e,n,t){return n?H(e,n):function(e,n){return M(e,{},n).then((function(e){return e.status<200||300<=e.status?z(e.status):U.resolve(e.blob)}))}(e,t)},X=function(){return W(0,0)},W=function(e,n){return{major:e,minor:n}},G=function(e,n){var t=String(n).toLowerCase();return 0===e.length?X():function(e,n){var t=function(e,n){for(var t=0;t<e.length;t++){var r=e[t];if(r.test(n))return r}}(e,n);if(!t)return{major:0,minor:0};var r=function(e){return Number(n.replace(t,"$"+e))};return W(r(1),r(2))}(e,t)},V=X,Y="Firefox",J=function(e,n){return function(){return n===e}},K=function(e){var n=e.current;return{current:n,version:e.version,isEdge:J("Edge",n),isChrome:J("Chrome",n),isIE:J("IE",n),isOpera:J("Opera",n),isFirefox:J(Y,n),isSafari:J("Safari",n)}},Q=function(){return K({current:void 0,version:V()})},Z=K,ee=(c("Edge"),c("Chrome"),c("IE"),c("Opera"),c(Y),c("Safari"),"Windows"),ne="Android",te="Solaris",re="FreeBSD",oe=function(e,n){return function(){return n===e}},ie=function(e){var n=e.current;return{current:n,version:e.version,isWindows:oe(ee,n),isiOS:oe("iOS",n),isAndroid:oe(ne,n),isOSX:oe("OSX",n),isLinux:oe("Linux",n),isSolaris:oe(te,n),isFreeBSD:oe(re,n)}},ue=function(){return ie({current:void 0,version:V()})},ae=ie,ce=(c(ee),c("iOS"),c(ne),c("Linux"),c("OSX"),c(te),c(re),function(e,n){var t=String(n).toLowerCase();return P(e,(function(e){return e.search(t)}))}),se=function(e,n){return-1!==e.indexOf(n)},fe=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,le=function(e){return function(n){return se(n,e)}},de=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return se(e,"edge/")&&se(e,"chrome")&&se(e,"safari")&&se(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,fe],search:function(e){return se(e,"chrome")&&!se(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return se(e,"msie")||se(e,"trident")}},{name:"Opera",versionRegexes:[fe,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:le("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:le("firefox")},{name:"Safari",versionRegexes:[fe,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(se(e,"safari")||se(e,"mobile/"))&&se(e,"applewebkit")}}],me=[{name:"Windows",search:le("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return se(e,"iphone")||se(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:le("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:le("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:le("linux"),versionRegexes:[]},{name:"Solaris",search:le("sunos"),versionRegexes:[]},{name:"FreeBSD",search:le("freebsd"),versionRegexes:[]}],he={browsers:c(de),oses:c(me)},ge={detect:(S=!(x=function(){return function(e){var n,t,r,o,i,u,a,s,f,l,d,m=he.browsers(),h=he.oses(),g=function(e,n){return ce(e,n).map((function(e){var t=G(e.versionRegexes,n);return{current:e.name,version:t}}))}(m,e).fold(Q,Z),v=function(e,n){return ce(e,n).map((function(e){var t=G(e.versionRegexes,n);return{current:e.name,version:t}}))}(h,e).fold(ue,ae);return{browser:g,os:v,deviceType:(t=g,r=e,o=(n=v).isiOS()&&!0===/ipad/i.test(r),i=n.isiOS()&&!o,u=n.isAndroid()&&3===n.version.major,a=n.isAndroid()&&4===n.version.major,s=o||u||a&&!0===/mobile/i.test(r),f=n.isiOS()||n.isAndroid(),l=f&&!s,d=t.isSafari()&&n.isiOS()&&!1===/safari/i.test(r),{isiPad:c(o),isiPhone:c(i),isTablet:c(s),isPhone:c(l),isTouch:c(f),isAndroid:n.isAndroid,isiOS:n.isiOS,isWebView:c(d)})}}(e.navigator.userAgent)}),function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return S||(S=!0,N=x.apply(null,e)),N})},ve=function(e){if(null==e)throw new Error("Node cannot be null or undefined");return{dom:c(e)}},pe=(e.Node.ATTRIBUTE_NODE,e.Node.CDATA_SECTION_NODE,e.Node.COMMENT_NODE,e.Node.DOCUMENT_NODE,e.Node.DOCUMENT_TYPE_NODE,e.Node.DOCUMENT_FRAGMENT_NODE,e.Node.ELEMENT_NODE),ye=(e.Node.TEXT_NODE,e.Node.PROCESSING_INSTRUCTION_NODE,e.Node.ENTITY_REFERENCE_NODE,e.Node.ENTITY_NODE,e.Node.NOTATION_NODE,pe),we=(ge.detect().browser.isIE(),function(e,n){return t=function(e){return function(e,n){var t=e.dom();if(t.nodeType!==ye)return!1;if(void 0!==t.matches)return t.matches(n);if(void 0!==t.msMatchesSelector)return t.msMatchesSelector(n);if(void 0!==t.webkitMatchesSelector)return t.webkitMatchesSelector(n);if(void 0!==t.mozMatchesSelector)return t.mozMatchesSelector(n);throw new Error("Browser lacks native selectors")}(e,n)},P(e.dom().childNodes,(r=t,o=ve,function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return r(o.apply(null,e))})).map(ve);var t,r,o}),be=0,Oe=function(e){return we(ve(e),"img")},Ee=function(e,n){return e.dom.is(n,"figure")},_e=function(e,n){e.notificationManager.open({text:n,type:"error"})},Te=function(e){var n=e.selection.getNode();return Ee(e,n)?Oe(n):v.some(ve(n))},Ie=function(e,n){var t=n.src;return 0===t.indexOf("data:")||0===t.indexOf("blob:")||new j(t).host===e.documentBaseURI.host},Re=function(e,n){return-1!==a.inArray(e.getParam("imagetools_cors_hosts",[],"string[]"),new j(n.src).host)},xe=function(n,t){var r;return(r=n.editorUpload.blobCache.getByUri(t.src))?U.resolve(r.blob()):function(n,t){return(r=n,v.from(r.getParam("imagetools_fetch_image",null,"function"))).fold((function(){return function(n,t){var r,o,i,u,c=t.src;return Re(n,t)?$(t.src,null,(o=n,i=t,-1!==a.inArray(o.getParam("imagetools_credentials_hosts",[],"string[]"),new j(i.src).host))):Ie(n,t)?function(n){var t=n.src;return 0===t.indexOf("data:")?_(t):function(n){return new O((function(t,r){var o=new e.XMLHttpRequest;o.open("GET",n,!0),o.responseType="blob",o.onload=function(){200===this.status&&t(this.response)},o.onerror=function(){var e;r(0===this.status?((e=new Error("No access to download image")).code=18,e.name="SecurityError",e):new Error("Error "+this.status+" downloading image"))},o.send()}))}(t)}(t):(c=n.getParam("imagetools_proxy"),c+=(-1===c.indexOf("?")?"?":"&")+"url="+encodeURIComponent(t.src),r=(u=n).getParam("api_key",u.getParam("imagetools_api_key","","string"),"string"),$(c,r,!1))}(n,t)}),(function(e){return e(t)}));var r}(n,t)},Ne=function(e){C.clearTimeout(e.get())},Se=function(e,n,t,r,o,i){return n.toBlob().then((function(u){var a,c,s,f,l,d;return s=e.editorUpload.blobCache,a=o.src,e.getParam("images_reuse_filename",!1,"boolean")&&(c=(f=s.getByUri(a))?(a=f.uri(),f.name()):(l=e,(d=a.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i))?l.dom.encode(d[1]):null)),f=s.create({id:"imagetools"+be++,blob:u,base64:n.toBase64(),uri:a,name:c}),s.add(f),e.undoManager.transact((function(){e.$(o).on("load",(function n(){var i,u,a;e.$(o).off("load",n),e.nodeChanged(),t?e.editorUpload.uploadImagesAuto():(Ne(r),i=e,u=r,a=C.setEditorTimeout(i,(function(){i.editorUpload.uploadImagesAuto()}),i.getParam("images_upload_timeout",3e4,"number")),u.set(a))})),i&&e.$(o).attr({width:i.w,height:i.h}),e.$(o).attr({src:f.blobUri()}).removeAttr("data-mce-src")})),f}))},Ae=function(e,n,t,r){return function(){return Te(e).fold((function(){_e(e,"Could not find selected image")}),(function(o){return e._scanForImages().then((function(){return xe(e,o.dom())})).then(A).then(t).then((function(t){return Se(e,t,!1,n,o.dom(),r)}),(function(n){_e(e,n)}))}))}},Ce=function(e,n,t){return function(){var r=Te(e).fold((function(){return null}),(function(e){var n=D(e.dom());return n?{w:n.h,h:n.w}:null}));return Ae(e,n,(function(e){return function(e,n){return e.toCanvas().then((function(t){return function(e,n,t){var r=p(e.width,e.height),o=w(r),i=0,u=0;return 90!==(t=t<0?360+t:t)&&270!==t||b(r,r.height,r.width),90!==t&&180!==t||(i=r.width),270!==t&&180!==t||(u=r.height),o.translate(i,u),o.rotate(t*Math.PI/180),o.drawImage(e,0,0),R(r,n)}(t,e.getType(),n)}))}(e,t)}),r)()}},Ue=function(e,n,t){return function(){return Ae(e,n,(function(e){return function(e,n){return e.toCanvas().then((function(t){return function(e,n,t){var r=p(e.width,e.height),o=w(r);return"v"===t?(o.scale(1,-1),o.drawImage(e,0,-r.height)):(o.scale(-1,1),o.drawImage(e,-r.width,0)),R(r,n)}(t,e.getType(),n)}))}(e,t)}))()}},je=function(e,n){var t=function(n){return t=n,e.dom.is(t,"img:not([data-mce-object],[data-mce-placeholder])")&&(Ie(e,n)||Re(e,n)||e.settings.imagetools_proxy);var t};return Ee(e,n)?Oe(n).map((function(e){return t(e.dom())?v.some(e.dom()):v.none()})):t(n)?v.some(n):v.none()},De=Ne,Le=xe,Pe=Te,ke=c("save-state"),Me=c("disable"),Be=c("enable"),Fe=function(n,t){return function(){var r=Pe(n),o=r.map((function(e){return L(e.dom())}));Pe(n).each((function(i){je(n,i.dom()).each((function(u){Le(n,i.dom()).then((function(i){var u,a={blob:u=i,url:e.URL.createObjectURL(u)};n.windowManager.open({title:"Edit Image",size:"large",body:{type:"panel",items:[{type:"imagetools",name:"imagetools",label:"Edit Image",currentState:a}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0,disabled:!0}],onSubmit:function(i){var u=i.getData().imagetools.blob;r.each((function(r){o.each((function(o){!function(n,t,r,o,i){new U((function(u){var a;(a=i,E(a)).then((function(n){var t=L(n);return o.w===t.w&&o.h===t.h||D(r)&&function(e,n){var t,r;n&&(t=e.style.width,r=e.style.height,(t||r)&&(e.style.width=n.w+"px",e.style.height=n.h+"px",e.removeAttribute("data-mce-style")),t=e.width,r=e.height,(t||r)&&(e.setAttribute("width",n.w),e.setAttribute("height",n.h)))}(r,t),e.URL.revokeObjectURL(n.src),i})).then(A).then((function(e){return Se(n,e,!0,t,r)}),(function(){}))}))}(n,t,r.dom(),o,u)}))})),i.close()},onCancel:function(){},onAction:function(e,n){switch(n.name){case ke():n.value?e.enable("save"):e.disable("save");break;case Me():e.disable("save"),e.disable("cancel");break;case Be():e.enable("cancel")}}})}))}))}))}};u.add("imagetools",(function(e){var n=i(0),t=i(null);(function(e,n){a.each({mceImageRotateLeft:Ce(e,n,-90),mceImageRotateRight:Ce(e,n,90),mceImageFlipVertical:Ue(e,n,"v"),mceImageFlipHorizontal:Ue(e,n,"h"),mceEditImage:Fe(e,n)},(function(n,t){e.addCommand(t,n)}))})(e,n),function(e){var n=function(n){return function(){return e.execCommand(n)}};e.ui.registry.addButton("rotateleft",{tooltip:"Rotate counterclockwise",icon:"rotate-left",onAction:n("mceImageRotateLeft")}),e.ui.registry.addButton("rotateright",{tooltip:"Rotate clockwise",icon:"rotate-right",onAction:n("mceImageRotateRight")}),e.ui.registry.addButton("flipv",{tooltip:"Flip vertically",icon:"flip-vertically",onAction:n("mceImageFlipVertical")}),e.ui.registry.addButton("fliph",{tooltip:"Flip horizontally",icon:"flip-horizontally",onAction:n("mceImageFlipHorizontal")}),e.ui.registry.addButton("editimage",{tooltip:"Edit image",icon:"edit-image",onAction:n("mceEditImage"),onSetup:function(n){var t=function(){Pe(e).each((function(t){var r=je(e,t.dom()).isNone();n.setDisabled(r)}))};return e.on("NodeChange",t),function(){e.off("NodeChange",t)}}}),e.ui.registry.addButton("imageoptions",{tooltip:"Image options",icon:"image-options",onAction:n("mceImage")}),e.ui.registry.addContextMenu("imagetools",{update:function(t){return je(e,t).fold((function(){return[]}),(function(e){return[{text:"Edit image",icon:"edit-image",onAction:n("mceEditImage")}]}))}})}(e),function(e){var n;e.ui.registry.addContextToolbar("imagetools",{items:(n=e,n.getParam("imagetools_toolbar","rotateleft rotateright flipv fliph editimage imageoptions")),predicate:function(n){return je(e,n).isSome()},position:"node",scope:"node"})}(e),function(e,n,t){e.on("NodeChange",(function(r){var o=t.get();o&&o.src!==r.element.src&&(De(n),e.editorUpload.uploadImagesAuto(),t.set(null)),je(e,r.element).each(t.set)}))}(e,n,t)}))}(window);