!function(){"use strict";var e=function(t){var n=t,r=function(){return n};return{get:r,set:function(e){n=e},clone:function(){return e(r())}}},t=tinymce.util.Tools.resolve("tinymce.PluginManager"),n=function(){return(n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},r=tinymce.util.Tools.resolve("tinymce.util.Tools");function o(e){return e&&1===e.nodeType&&"false"===e.contentEditable}var i,a,c,u,d=function(e){var t=e.getAttribute("data-mce-index");return"number"==typeof t?""+t:t},l=function(e){var t=e.parentNode;e.firstChild&&t.insertBefore(e.firstChild,e),e.parentNode.removeChild(e)},f=function(e,t){var n,o=[];if((n=r.toArray(e.getBody().getElementsByTagName("span"))).length)for(var i=0;i<n.length;i++){var a=d(n[i]);null!==a&&a.length&&a===t.toString()&&o.push(n[i])}return o},s=function(e,t,n){var r=t.get(),o=r.index,i=e.dom;(n=!1!==n)?o+1===r.count?o=0:o++:o-1==-1?o=r.count-1:o--,i.removeClass(f(e,r.index),"mce-match-marker-selected");var a=f(e,o);return a.length?(i.addClass(f(e,o),"mce-match-marker-selected"),e.selection.scrollIntoView(a[0]),o):-1},g=function(e,t){var n=t.parentNode;e.remove(t),e.isEmpty(n)&&e.remove(n)},p=function(e,t,n,r,i){n=(n=n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")).replace(/\s/g,"[^\\S\\r\\n]"),n=i?"\\b"+n+"\\b":n;var a,c,u,d,l,f=(a=e,c=t,u=new RegExp(n,r?"g":"gi"),(l=a.dom.create("span",{"data-mce-bogus":1})).className="mce-match-marker",d=a.getBody(),b(a,c,!1),function(e,t,n,r,i){var a,c,u,d,l,f,s=[],g=0;function p(e,t){if(t=t||0,!e[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");var n=e.index;if(0<t){var r=e[t];if(!r)throw new Error("Invalid capture group");n+=e[0].indexOf(r),e[0]=r}return[n,n+e[0].length,[e[0]]]}if(u=t.ownerDocument,d=i.getBlockElements(),l=i.getWhiteSpaceElements(),f=i.getShortEndedElements(),c=function e(t){var n;if(3===t.nodeType)return t.data;if(l[t.nodeName]&&!d[t.nodeName])return"";if(n="",o(t))return"\n";if((d[t.nodeName]||f[t.nodeName])&&(n+="\n"),t=t.firstChild)for(;n+=e(t),t=t.nextSibling;);return n}(t)){if(e.global)for(;a=e.exec(c);)s.push(p(a,r));else a=c.match(e),s.push(p(a,r));return s.length&&(g=s.length,function(e,t,n){var r,i,a,c,u=[],s=0,g=e,p=t.shift(),m=0;e:for(;;){if((d[g.nodeName]||f[g.nodeName]||o(g))&&s++,3===g.nodeType&&(!i&&g.length+s>=p[1]?(i=g,c=p[1]-s):r&&u.push(g),!r&&g.length+s>p[0]&&(r=g,a=p[0]-s),s+=g.length),r&&i){if(g=n({startNode:r,startNodeIndex:a,endNode:i,endNodeIndex:c,innerNodes:u,match:p[2],matchIndex:m}),s-=i.length-c,i=r=null,u=[],m++,!(p=t.shift()))break}else if(l[g.nodeName]&&!d[g.nodeName]||!g.firstChild){if(g.nextSibling){g=g.nextSibling;continue}}else if(!o(g)){g=g.firstChild;continue}for(;;){if(g.nextSibling){g=g.nextSibling;break}if(g.parentNode===e)break e;g=g.parentNode}}}(t,s,function(e){var t;if("function"!=typeof e){var n=e.nodeType?e:u.createElement(e);t=function(e,t){var r=n.cloneNode(!1);return r.setAttribute("data-mce-index",t),e&&r.appendChild(u.createTextNode(e)),r}}else t=e;return function(e){var n,r,o,i=e.startNode,a=e.endNode,c=e.matchIndex;if(i===a){var d=i;o=d.parentNode,0<e.startNodeIndex&&(n=u.createTextNode(d.data.substring(0,e.startNodeIndex)),o.insertBefore(n,d));var l=t(e.match[0],c);return o.insertBefore(l,d),e.endNodeIndex<d.length&&(r=u.createTextNode(d.data.substring(e.endNodeIndex)),o.insertBefore(r,d)),d.parentNode.removeChild(d),l}n=u.createTextNode(i.data.substring(0,e.startNodeIndex)),r=u.createTextNode(a.data.substring(e.endNodeIndex));for(var f=t(i.data.substring(e.startNodeIndex),c),s=0,g=e.innerNodes.length;s<g;++s){var p=e.innerNodes[s],m=t(p.data,c);p.parentNode.replaceChild(m,p)}var h=t(a.data.substring(0,e.endNodeIndex),c);return(o=i.parentNode).insertBefore(n,i),o.insertBefore(f,i),o.removeChild(i),(o=a.parentNode).insertBefore(h,a),o.insertBefore(r,a),o.removeChild(a),h}}(n))),g}}(u,d,l,!1,a.schema));if(f){var g=s(e,t,!0);t.set({index:g,count:f,text:n,matchCase:r,wholeWord:i})}return f},m=function(e,t){var r=s(e,t,!0);t.set(n({},t.get(),{index:r}))},h=function(e,t){var r=s(e,t,!1);t.set(n({},t.get(),{index:r}))},x=function(e){var t=d(e);return null!==t&&0<t.length},v=function(e,t,o,i,a){var c,u,f,s,p,v=t.get(),b=v.index,y=b;for(i=!1!==i,f=e.getBody(),u=r.grep(r.toArray(f.getElementsByTagName("span")),x),c=0;c<u.length;c++){var N=d(u[c]);if(s=p=parseInt(N,10),a||s===v.index){for(o.length?(u[c].firstChild.nodeValue=o,l(u[c])):g(e.dom,u[c]);u[++c];){if((s=parseInt(d(u[c]),10))!==p){c--;break}g(e.dom,u[c])}i&&y--}else b<p&&u[c].setAttribute("data-mce-index",String(p-1))}return t.set(n({},v,{count:a?0:v.count-1,index:y})),i?m(e,t):h(e,t),!a&&0<t.get().count},b=function(e,t,o){var i,a,c,u,f=t.get();for(a=r.toArray(e.getBody().getElementsByTagName("span")),i=0;i<a.length;i++){var s=d(a[i]);null!==s&&s.length&&(s===f.index.toString()&&(c||(c=a[i].firstChild),u=a[i].firstChild),l(a[i]))}if(t.set(n({},f,{index:-1,count:0,text:""})),c&&u){var g=e.dom.createRng();return g.setStart(c,0),g.setEnd(u,u.data.length),!1!==o&&e.selection.setRng(g),g}},y=function(e){return function(){return e}},N=y(!1),C=y(!0),w=N,S=C,A=function(){return O},O=(u={fold:function(e,t){return e()},is:w,isSome:w,isNone:S,getOr:c=function(e){return e},getOrThunk:a=function(e){return e()},getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){},or:c,orThunk:a,map:A,ap:A,each:function(){},bind:A,flatten:A,exists:w,forall:S,filter:A,equals:i=function(e){return e.isNone()},equals_:i,toArray:function(){return[]},toString:y("none()")},Object.freeze&&Object.freeze(u),u),T=function(e){var t=function(){return e},n=function(){return o},r=function(t){return t(e)},o={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:S,isNone:w,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:n,orThunk:n,map:function(t){return T(t(e))},ap:function(t){return t.fold(A,(function(t){return T(t(e))}))},each:function(t){t(e)},bind:r,flatten:t,exists:r,forall:r,filter:function(t){return t(e)?o:O},equals:function(t){return t.is(e)},equals_:function(t,n){return t.fold(w,(function(t){return n(e,t)}))},toArray:function(){return[e]},toString:function(){return"some("+e+")"}};return o},B={some:T,none:A,from:function(e){return null==e?O:T(e)}},I=(Array.prototype.slice,function(e){return"function"===function(e){if(null===e)return"null";var t=typeof e;return"object"===t&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":t}(e)}(Array.from)&&Array.from,function(t,n){var o,i=(o=e(B.none()),{clear:function(){o.set(B.none())},set:function(e){o.set(B.some(e))},isSet:function(){return o.get().isSome()},on:function(e){o.get().each(e)}}),a=e(n.get().matchCase),c=e(n.get().wholeWord);t.undoManager.add();var u=r.trim(t.selection.getContent({format:"text"}));function d(e){(1<n.get().count?e.enable:e.disable)("next"),(1<n.get().count?e.enable:e.disable)("prev")}var l=function(e,t){!function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n,e)}(["replace","replaceall","prev","next"],t?e.disable:e.enable)},f=function(e){b(t,n,!1),l(e,!0),d(e)},s=function(e){var r=e.getData(),o=n.get();if(r.findtext.length){if(o.text===r.findtext&&o.matchCase===a.get()&&o.wholeWord===c.get())m(t,n);else{var i=p(t,n,r.findtext,a.get(),c.get());i<=0&&function(e){t.windowManager.alert("Could not find the specified string.",(function(){e.focus("findtext")}))}(e),l(e,0===i)}d(e)}else f(e)},g={title:"Find and Replace",size:"normal",body:{type:"panel",items:[{type:"bar",items:[{type:"input",name:"findtext",placeholder:"Find",maximized:!0},{type:"button",name:"prev",text:"Previous",icon:"action-prev",disabled:!0,borderless:!0},{type:"button",name:"next",text:"Next",icon:"action-next",disabled:!0,borderless:!0}]},{type:"input",name:"replacetext",placeholder:"Replace with"}]},buttons:[{type:"menu",name:"options",icon:"preferences",tooltip:"Preferences",align:"start",fetch:function(e){e([{type:"togglemenuitem",text:"Match case",onAction:function(e){a.set(!a.get()),i.on((function(e){return e.focus("options")}))},active:a.get()},{type:"togglemenuitem",text:"Find whole words only",onAction:function(e){c.set(!c.get()),i.on((function(e){return e.focus("options")}))},active:c.get()}])}},{type:"custom",name:"find",text:"Find",primary:!0},{type:"custom",name:"replace",text:"Replace",disabled:!0},{type:"custom",name:"replaceall",text:"Replace All",disabled:!0}],initialData:{findtext:u,replacetext:""},onChange:function(e,t){"findtext"===t.name&&0<n.get().count&&f(e)},onAction:function(e,r){var o=e.getData();switch(r.name){case"find":s(e);break;case"replace":v(t,n,o.replacetext)?d(e):f(e);break;case"replaceall":v(t,n,o.replacetext,!0,!0),f(e);break;case"prev":h(t,n),d(e);break;case"next":m(t,n),d(e)}},onSubmit:s,onClose:function(){t.focus(),b(t,n),t.undoManager.add()}};i.set(t.windowManager.open(g,{inline:"toolbar"}))}),k=function(e,t){return function(){I(e,t)}};t.add("searchreplace",(function(t){var n=e({index:-1,count:0,text:"",matchCase:!1,wholeWord:!1});return function(e,t){e.addCommand("SearchReplace",(function(){I(e,t)}))}(t,n),function(e,t){e.ui.registry.addMenuItem("searchreplace",{text:"Find and replace...",shortcut:"Meta+F",onAction:k(e,t),icon:"search"}),e.ui.registry.addButton("searchreplace",{tooltip:"Find and replace",onAction:k(e,t),icon:"search"}),e.shortcuts.add("Meta+F","",k(e,t))}(t,n),function(e,t){return{done:function(n){return b(e,t,n)},find:function(n,r,o){return p(e,t,n,r,o)},next:function(){return m(e,t)},prev:function(){return h(e,t)},replace:function(n,r,o){return v(e,t,n,r,o)}}}(t,n)}))}();