!function(t){"use strict";var n,e,r,o,a,i=function(t){var n=t,e=function(){return n};return{get:e,set:function(t){n=t},clone:function(){return i(e())}}},u=tinymce.util.Tools.resolve("tinymce.PluginManager"),f=function(){},c=function(t){return function(){return t}},s=function(t){return t},l=c(!1),d=c(!0),m=l,g=d,p=function(){return h},h=(o={fold:function(t,n){return t()},is:m,isSome:m,isNone:g,getOr:r=function(t){return t},getOrThunk:e=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){},or:r,orThunk:e,map:p,ap:p,each:function(){},bind:p,flatten:p,exists:m,forall:g,filter:p,equals:n=function(t){return t.isNone()},equals_:n,toArray:function(){return[]},toString:c("none()")},Object.freeze&&Object.freeze(o),o),v=function(t){var n=function(){return t},e=function(){return o},r=function(n){return n(t)},o={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:g,isNone:m,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:e,orThunk:e,map:function(n){return v(n(t))},ap:function(n){return n.fold(p,(function(n){return v(n(t))}))},each:function(n){n(t)},bind:r,flatten:n,exists:r,forall:r,filter:function(n){return n(t)?o:h},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(m,(function(n){return e(t,n)}))},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return o},y={some:v,none:p,from:function(t){return null==t?h:v(t)}},k=function(t){return function(n){return function(t){if(null===t)return"null";var n=typeof t;return"object"===n&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"===n&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":n}(n)===t}},b=k("string"),O=k("object"),w=k("array"),E=k("function"),C=Array.prototype.slice,x=void 0===(a=Array.prototype.indexOf)?function(t,n){return S(t,n)}:function(t,n){return a.call(t,n)},T=function(t,n){for(var e=t.length,r=new Array(e),o=0;o<e;o++){var a=t[o];r[o]=n(a,o,t)}return r},N=function(t,n){for(var e=0,r=t.length;e<r;e++)n(t[e],e,t)},R=function(t,n){for(var e=[],r=0,o=t.length;r<o;r++){var a=t[r];n(a,r,t)&&e.push(a)}return e},P=function(t,n,e){return function(t,n){for(var e=t.length-1;0<=e;e--)n(t[e])}(t,(function(t){e=n(e,t)})),e},S=function(t,n){for(var e=0,r=t.length;e<r;++e)if(t[e]===n)return e;return-1},M=function(t,n){for(var e=0,r=t.length;e<r;++e)if(!0!==n(t[e],e,t))return!1;return!0},A=(E(Array.from)&&Array.from,Object.keys),D=Object.hasOwnProperty,j=function(t,n){return D.call(t,n)},B=function(n){if(!w(n))throw new Error("cases must be an array");if(0===n.length)throw new Error("there must be at least one case");var e=[],r={};return N(n,(function(o,a){var i=A(o);if(1!==i.length)throw new Error("one and only one name per case");var u=i[0],f=o[u];if(void 0!==r[u])throw new Error("duplicate key detected:"+u);if("cata"===u)throw new Error("cannot have a case named cata (sorry)");if(!w(f))throw new Error("case arguments must be an array");e.push(u),r[u]=function(){var r=arguments.length;if(r!==f.length)throw new Error("Wrong number of arguments to case "+u+". Expected "+f.length+" ("+f+"), got "+r);for(var o=new Array(r),i=0;i<o.length;i++)o[i]=arguments[i];return{fold:function(){if(arguments.length!==n.length)throw new Error("Wrong number of arguments to fold. Expected "+n.length+", got "+arguments.length);return arguments[a].apply(null,o)},match:function(t){var n=A(t);if(e.length!==n.length)throw new Error("Wrong number of arguments to match. Expected: "+e.join(",")+"\nActual: "+n.join(","));if(!M(e,(function(t){return-1<x(n,t)})))throw new Error("Not all branches were specified when using match. Specified: "+n.join(", ")+"\nRequired: "+e.join(", "));return t[u].apply(null,o)},log:function(n){t.console.log(n,{constructors:e,constructor:u,params:o})}}}})),r},I=(B([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(t){var n=[],e=[];return N(t,(function(t){t.fold((function(t){n.push(t)}),(function(t){e.push(t)}))})),{errors:n,values:e}}),_=function(t){return{is:function(n){return t===n},isValue:d,isError:l,getOr:c(t),getOrThunk:c(t),getOrDie:c(t),or:function(n){return _(t)},orThunk:function(n){return _(t)},fold:function(n,e){return e(t)},map:function(n){return _(n(t))},mapError:function(n){return _(t)},each:function(n){n(t)},bind:function(n){return n(t)},exists:function(n){return n(t)},forall:function(n){return n(t)},toOption:function(){return y.some(t)}}},L=function(t){return{is:l,isValue:l,isError:d,getOr:s,getOrThunk:function(t){return t()},getOrDie:function(){return n=String(t),function(){throw new Error(n)}();var n},or:function(t){return t},orThunk:function(t){return t()},fold:function(n,e){return n(t)},map:function(n){return L(t)},mapError:function(n){return L(n(t))},each:f,bind:function(n){return L(t)},exists:l,forall:d,toOption:y.none}},U={value:_,error:L,fromOption:function(t,n){return t.fold((function(){return L(n)}),_)}},q=function(t){return"inline-command"===t.type||"inline-format"===t.type},V=function(t){return"block-command"===t.type||"block-format"===t.type},W=function(t){return n=t,e=function(t,n){return t.start.length===n.start.length?0:t.start.length>n.start.length?-1:1},(r=C.call(n,0)).sort(e),r;var n,e,r},X=function(t){var n=function(n){return U.error({message:n,pattern:t})},e=function(e,r,o){if(void 0===t.format)return void 0!==t.cmd?b(t.cmd)?U.value(o(t.cmd,t.value)):n(e+" pattern has non-string `cmd` parameter"):n(e+" pattern is missing both `format` and `cmd` parameters");var a=void 0;if(w(t.format)){if(!M(t.format,b))return n(e+" pattern has non-string items in the `format` array");a=t.format}else{if(!b(t.format))return n(e+" pattern has non-string `format` parameter");a=[t.format]}return U.value(r(a))};if(!O(t))return n("Raw pattern is not an object");if(!b(t.start))return n("Raw pattern is missing `start` parameter");if(void 0===t.end)return void 0!==t.replacement?b(t.replacement)?0===t.start.length?n("Replacement pattern has empty `start` parameter"):U.value({type:"inline-command",start:"",end:t.start,cmd:"mceInsertContent",value:t.replacement}):n("Replacement pattern has non-string `replacement` parameter"):0===t.start.length?n("Block pattern has empty `start` parameter"):e("Block",(function(n){return{type:"block-format",start:t.start,format:n[0]}}),(function(n,e){return{type:"block-command",start:t.start,cmd:n,value:e}}));if(!b(t.end))return n("Inline pattern has non-string `end` parameter");if(0===t.start.length&&0===t.end.length)return n("Inline pattern has empty `start` and `end` parameters");var r=t.start,o=t.end;return 0===o.length&&(o=r,r=""),e("Inline",(function(t){return{type:"inline-format",start:r,end:o,format:t}}),(function(t,n){return{type:"inline-command",start:r,end:o,cmd:t,value:n}}))},z=function(t){return"block-command"===t.type?{start:t.start,cmd:t.cmd,value:t.value}:"block-format"===t.type?{start:t.start,format:t.format}:"inline-command"===t.type?"mceInsertContent"===t.cmd&&""===t.start?{start:t.end,replacement:t.value}:{start:t.start,end:t.end,cmd:t.cmd,value:t.value}:"inline-format"===t.type?{start:t.start,end:t.end,format:1===t.format.length?t.format[0]:t.format}:void 0},F=function(t){return{inlinePatterns:R(t,q),blockPatterns:W(R(t,V))}},J=void 0!==t.window?t.window:Function("return this;")(),K=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e=J.console;e&&(e.error?e.error.apply(e,t):e.log.apply(e,t))},G=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],H=tinymce.util.Tools.resolve("tinymce.util.Delay"),Q=tinymce.util.Tools.resolve("tinymce.util.VK"),Y=tinymce.util.Tools.resolve("tinymce.util.Tools"),Z=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),$=function(n){return n.nodeType===t.Node.TEXT_NODE},tt=function(t,n,e){if(n&&t.isEmpty(n)&&!e(n)){var r=n.parentNode;t.remove(n),tt(t,r,e)}},nt=function(t,n,e,r){void 0===r&&(r=!0);var o=n.startContainer.parentNode,a=n.endContainer.parentNode;n.deleteContents(),r&&!e(n.startContainer)&&($(n.startContainer)&&0===n.startContainer.data.length&&t.remove(n.startContainer),$(n.endContainer)&&0===n.endContainer.data.length&&t.remove(n.endContainer),tt(t,o,e),o!==a&&tt(t,a,e))},et=function(t){return 0===t.start.length},rt=function(t,n){return{element:t,offset:n}},ot=function(n,e){var r=new Z(n,e),o=function(n){for(var e=r[n]();e&&e.nodeType!==t.Node.TEXT_NODE;)e=r[n]();return e&&e.nodeType===t.Node.TEXT_NODE?y.some(e):y.none()};return{next:function(){return o("next")},prev:function(){return o("prev")},prev2:function(){return o("prev2")}}},at=function(t,n,e){return $(t)&&0<=n?y.some(rt(t,n)):ot(t,e).prev().map((function(t){return rt(t,t.data.length)}))},it=function(t,n,e){if(!$(t))return y.none();var r=t.textContent;return 0<=n&&n<=r.length?y.some(rt(t,n)):ot(t,e).prev().bind((function(t){var r=t.textContent;return it(t,n+r.length,e)}))},ut=function(t,n,e){if(!$(t))return y.none();var r=t.textContent;return n<=r.length?y.some(rt(t,n)):ot(t,e).next().bind((function(t){return ut(t,n-r.length,e)}))},ft=B([{aborted:[]},{edge:["element"]},{success:["info"]}]),ct=B([{abort:[]},{kontinue:[]},{finish:["info"]}]),st=function(t,n,e,r,o,a){var i=function(){return a.fold(ft.aborted,ft.edge)},u=function(){var e=o();return e?st(t,e,y.none(),r,o,y.some(n)):i()};if(t.isBlock(n))return i();if($(n)){var f=n.textContent;return r(ct,n,f,e).fold(ft.aborted,(function(){return u()}),ft.success)}return u()},lt=function(t,n,e){if($(n)&&(e<0||e>n.data.length))return[];for(var r=[e],o=n;o!==t&&o.parentNode;){for(var a=o.parentNode,i=0;i<a.childNodes.length;i++)if(a.childNodes[i]===o){r.push(i);break}o=a}return o===t?r.reverse():[]},dt=function(t,n,e,r,o){return{start:lt(t,n,e),end:lt(t,r,o)}},mt=function(t,n){var e,r,o,a=n.slice(),i=a.pop();return(e=a,r=function(t,n){return t.bind((function(t){return y.from(t.childNodes[n])}))},o=y.some(t),N(e,(function(t){o=r(o,t)})),o).bind((function(t){return $(t)&&0<=i&&t.data.length,y.some({node:t,offset:i})}))},gt=function(n,e){return mt(n,e.start).bind((function(r){var o=r.node,a=r.offset;return mt(n,e.end).map((function(n){var e=n.node,r=n.offset,i=t.document.createRange();return i.setStart(o,a),i.setEnd(e,r),i}))}))},pt=function(t,n,e){ot(n,n).next().each((function(r){ut(r,e.start.length,n).each((function(e){var o=t.createRng();o.setStart(r,0),o.setEnd(e.element,e.offset),nt(t,o,(function(t){return t===n}))}))}))},ht=function(){return(ht=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},vt=0,yt=function(t,n){return t.create("span",{"data-mce-type":"bookmark",id:n})},kt=function(t,n){var e=t.createRng();return e.setStartAfter(n.start),e.setEndBefore(n.end),e},bt=function(t,n,e){var r=gt(t.getRoot(),e).getOrDie("Unable to resolve path range"),o=r.startContainer,a=r.endContainer,i=0===r.endOffset?a:a.splitText(r.endOffset),u=0===r.startOffset?o:o.splitText(r.startOffset);return{prefix:n,end:i.parentNode.insertBefore(yt(t,n+"-end"),i),start:u.parentNode.insertBefore(yt(t,n+"-start"),u)}},Ot=function(t,n,e){tt(t,t.get(n.prefix+"-end"),e),tt(t,t.get(n.prefix+"-start"),e)},wt=function(t,n,e){var r=t.dom,o=r.getRoot(),a=e.pattern,i=e.position.element,u=e.position.offset;return it(i,u-e.pattern.end.length,n).bind((function(f){var c=dt(o,f.element,f.offset,i,u);if(et(a))return y.some({matches:[{pattern:a,startRng:c,endRng:c}],position:f});var s=Et(t,e.remainingPatterns,f.element,f.offset,n),l=s.getOr({matches:[],position:f}),d=l.position;return function(t,n,e,r,o,a){if(void 0===a&&(a=!1),0!==n.start.length||a)return at(e,r,o).bind((function(e){var r,i,u,f,c,s,l,d;return(r=t,i=e.element,u=e.offset,s=t,l=o,d=n.start,f=function(t,n,e,r){if(n===l)return t.abort();var o=e.substring(0,r.getOr(e.length)),a=o.lastIndexOf(d.charAt(d.length-1)),i=o.lastIndexOf(d);if(-1===i)return-1!==a?it(n,a+1-d.length,l).fold((function(){return t.kontinue()}),(function(e){var r=s.createRng();return r.setStart(e.element,e.offset),r.setEnd(n,a+1),r.toString()===d?t.finish(r):t.kontinue()})):t.kontinue();var u=s.createRng();return u.setStart(n,i),u.setEnd(n,i+d.length),t.finish(u)},c=new Z(i,o),st(r,i,y.some(u),f,c.prev,y.none())).fold(y.none,y.none,y.some).bind((function(t){if(a){if(t.endContainer===e.element&&t.endOffset===e.offset)return y.none();if(0===e.offset&&t.endContainer.textContent.length===t.endOffset)return y.none()}return y.some(t)}))}));var i=t.createRng();return i.setStart(e,r),i.setEnd(e,r),y.some(i)}(r,a,d.element,d.offset,n,s.isNone()).map((function(t){var n,e=dt(o,(n=t).startContainer,n.startOffset,n.endContainer,n.endOffset);return{matches:l.matches.concat([{pattern:a,startRng:e,endRng:c}]),position:rt(t.startContainer,t.startOffset)}}))}))},Et=function(t,n,e,r,o){var a=t.dom;return at(e,r,a.getRoot()).bind((function(i){var u=a.createRng();u.setStart(o,0),u.setEnd(e,r);for(var f,c,s,l,d,m=u.toString(),g=0;g<n.length;g++){var p=n[g];if(f=m,s=void 0,l=c=p.end,d=(s=f).length-c.length,""===l||!(s.length<l.length||s.substr(d,d+l.length)!==l)){var h=n.slice();h.splice(g,1);var v=wt(t,o,{pattern:p,remainingPatterns:h,position:i});if(v.isSome())return v}}return y.none()}))},Ct=function(t,n,e){t.selection.setRng(e),"inline-format"===n.type?N(n.format,(function(n){t.formatter.apply(n)})):t.execCommand(n.cmd,!1,n.value)},xt=function(t,n,e){var r=t.selection.getRng();if(!1===r.collapsed)return[];var o=t.dom.getParent(r.startContainer,t.dom.isBlock),a=r.startOffset-(e?1:0);return Et(t,n,r.startContainer,a,o).fold((function(){return[]}),(function(t){return t.matches}))},Tt=function(t,n){if(0!==n.length){var e=t.dom,r=t.selection.getBookmark(),o=function(t,n){var e,r=(e=(new Date).getTime(),"mce_textpattern_"+Math.floor(1e9*Math.random())+ ++vt+String(e)),o=P(n,(function(n,e){var o=bt(t,r+"_end"+n.length,e.endRng);return n.concat([ht({},e,{endMarker:o})])}),[]);return P(o,(function(n,e){var a=o.length-n.length-1,i=et(e.pattern)?e.endMarker:bt(t,r+"_start"+a,e.startRng);return n.concat([ht({},e,{startMarker:i})])}),[])}(e,n);N(o,(function(n){var r,o,a,i,u,f=e.getParent(n.startMarker.start,e.isBlock),c=function(t){return t===f};et(n.pattern)?(r=t,o=n.pattern,a=n.endMarker,i=c,u=kt(r.dom,a),nt(r.dom,u,i),Ct(r,o,u)):function(t,n,e,r,o){var a=t.dom,i=kt(a,r),u=kt(a,e);nt(a,u,o),nt(a,i,o);var f={prefix:e.prefix,start:e.end,end:r.start},c=kt(a,f);Ct(t,n,c)}(t,n.pattern,n.startMarker,n.endMarker,c),Ot(e,n.endMarker,c),Ot(e,n.startMarker,c)})),t.selection.moveToBookmark(r)}},Nt=function(t,n,e){for(var r=0;r<t.length;r++)if(e(t[r],n))return!0},Rt=function(t,n){var e=xt(t,n.inlinePatterns,!0);0<e.length&&t.undoManager.transact((function(){Tt(t,e)}))},Pt=function(n,e){var r=[",",".",";",":","!","?"],o=[32];n.on("keydown",(function(r){13!==r.keyCode||Q.modifierPressed(r)||function(n,e){if(!n.selection.isCollapsed())return!1;var r=xt(n,e.inlinePatterns,!1),o=function(n,e){var r=n.dom,o=n.selection.getRng(),a=r.getParent(o.startContainer,r.isBlock);if(!r.is(a,"p")||a.nodeType!==t.Node.ELEMENT_NODE)return[];var i=a.textContent;return function(t,n){return function(t,n){for(var e=0,r=t.length;e<r;e++){var o=t[e];if(n(o))return y.some(o)}return y.none()}(t,(function(t){return!(0!==n.indexOf(t.start)||j(t,"end")&&t.end&&n.lastIndexOf(t.end)!==n.length-t.end.length)}))}(e,i).map((function(t){return Y.trim(i).length===t.start.length?[]:[{pattern:t,range:dt(r.getRoot(),a,0,a,0)}]})).getOr([])}(n,e.blockPatterns);return(0<o.length||0<r.length)&&(n.undoManager.add(),n.undoManager.extra((function(){n.execCommand("mceInsertNewLine")}),(function(){n.insertContent("\ufeff"),Tt(n,r),function(t,n){if(0!==n.length){var e=t.selection.getBookmark();N(n,(function(n){return r=n,o=(e=t).dom,a=r.pattern,i=gt(o.getRoot(),r.range).getOrDie("Unable to resolve path range"),u=o.getParent(i.startContainer,o.isBlock),"block-format"===a.type?function(t,n){var e,r=n.get(t);return w(r)&&(e=r,0===e.length?y.none():y.some(e[0])).exists((function(t){return j(t,"block")}))}(a.format,e.formatter)&&e.undoManager.transact((function(){pt(e.dom,u,a),e.formatter.apply(a.format)})):"block-command"===a.type&&e.undoManager.transact((function(){pt(e.dom,u,a),e.execCommand(a.cmd,!1,a.value)})),!0;var e,r,o,a,i,u})),t.selection.moveToBookmark(e)}}(n,o);var t=n.selection.getRng(),e=at(t.startContainer,t.startOffset,n.dom.getRoot());n.execCommand("mceInsertNewLine"),e.each((function(t){"\ufeff"===t.element.data.charAt(t.offset-1)&&(t.element.deleteData(t.offset-1,1),tt(n.dom,t.element.parentNode,(function(t){return t===n.dom.getRoot()})))}))})),!0)}(n,e.get())&&r.preventDefault()}),!0),n.on("keyup",(function(t){(function(t,n){return Nt(t,n,(function(t,n){return t===n.keyCode&&!1===Q.modifierPressed(n)}))})(o,t)&&Rt(n,e.get())})),n.on("keypress",(function(t){(function(t,n){return Nt(t,n,(function(t,n){return t.charCodeAt(0)===n.charCode}))})(r,t)&&H.setEditorTimeout(n,(function(){Rt(n,e.get())}))}))};u.add("textpattern",(function(t){var n=i(function(t){var n,e,r=(n=t,e="textpattern_patterns",j(n,e)?y.from(n[e]):y.none()).getOr(G);if(!w(r))return K("The setting textpattern_patterns should be an array"),{inlinePatterns:[],blockPatterns:[]};var o=I(T(r,X));return N(o.errors,(function(t){return K(t.message,t.pattern)})),F(o.values)}(t.settings));return Pt(t,n),function(t){return{setPatterns:function(n){var e=I(T(n,X));if(0<e.errors.length){var r=e.errors[0];throw new Error(r.message+":\n"+JSON.stringify(r.pattern,null,2))}t.set(F(e.values))},getPatterns:function(){return T(t.get().inlinePatterns,z).concat(T(t.get().blockPatterns,z))}}}(n)}))}(window);